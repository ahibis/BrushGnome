var b=Object.defineProperty;var x=(o,t,s)=>t in o?b(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var u=(o,t,s)=>(x(o,typeof t!="symbol"?t+"":t,s),s);import{o as h,c,a as l,w as g,v,F as p,r as f,b as m,t as w,d as I,e as C}from"./vendor.d242409d.js";const M=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))a(i);new MutationObserver(i=>{for(const e of i)if(e.type==="childList")for(const n of e.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function s(i){const e={};return i.integrity&&(e.integrity=i.integrity),i.referrerpolicy&&(e.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?e.credentials="include":i.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function a(i){if(i.ep)return;i.ep=!0;const e=s(i);fetch(i.href,e)}};M();class B{loadImg(t){if(t==this._src&&this._img)return this._img;let s=this;return new Promise((a,i)=>{let e=new Image;e.src=t,s._src=t,this._img=e,e.onload=n=>{a(e)}})}constructor(t="",s=0,a=0,i=0){this.x=s,this.y=a,this.src=t,this.mode=0,this.type="Image",this.name="test",this.width=i,this.imgWidth=100,this.imgHeight=100,this.opacity=1,this.height=100,this._img=null,this._src=null,this.pixels=null,this.lastWidth=null}async getHeight(){let t=await this.loadImg(this.src);return this.imgWidth=t.width,this.imgHeight=t.height,this.width==0&&(this.width=this.imgWidth),this.width>engine.width&&(this.width=engine.width),this.height=this.width*t.height/t.width,this.height}async draw(t){this._img=await this.loadImg(this.src);let s=this._img;await this.getHeight(),t.drawImage(this._img,this.x,this.y,this.width,this.width*s.height/s.width)}async getData(){const t=document.createElement("canvas"),{width:s,height:a}=engine;t.width=s,t.height=a;const i=t.getContext("2d");await this.draw(i);let e=await i.getImageData(0,0,s,a).data;return this.pixels=e,e}async getDataWithOptions(){let t;if(t=await this.getData(),this.lastWidth=this.width,this.opacity<.95||vm.canal!="RGB"){const[s,a,i]=[!/R/.test(vm.canal),!/G/.test(vm.canal),!/B/.test(vm.canal)];t=t.map((e,n)=>{let d=n%4;return d==0&&s||d==1&&a||d==2&&i?0:this.opacity<.95?~~(e*this.opacity):e})}return t}async useMode(t){const{mode:s}=this;let a=await this.getDataWithOptions();return s==0?t.map((i,e)=>{let n=i+a[e];return n>255&&(n=255),n}):s==1?t.map((i,e)=>~~((i+a[e])/2)):s==2?t.map((i,e)=>~~(i*a[e]/256)):s==3?t.map((i,e)=>max(i,a[e])):s==4?t.map((i,e)=>min(i,a[e])):s==5?t.map((i,e)=>e%4!=3?i:a[e]):s==6?t.map((i,e)=>a[e]):t}}class D{constructor(t,s){u(this,"imgs",[]);u(this,"el");u(this,"width",1080);u(this,"height",768);u(this,"ctx");[this.el,this.imgs]=[t,s],this.ctx=t.getContext("2d"),t.width=this.width,t.height=this.height}canvasToImg(t){let s=t.toDataURL(),a=new Image;return a.src=s,a}saveImage(t){let s=document.createElement("a");s.setAttribute("href",t.src),s.setAttribute("download","outImg"),s.click()}downImg(){this.saveImage(this.canvasToImg(this.el))}async drawHist(){const t=document.getElementById("hist").getContext("2d"),{ctx:s,width:a,height:i}=this;let e=await s.getImageData(0,0,a,i).data,n=[..._.range(0,256)],d=n.map(r=>0);for(let r in e)r%4!=3&&(d[e[r]]+=1);d[0]=0,new Chart(t,{type:"bar",data:{labels:n,datasets:[{label:"Histogram",data:d,backgroundColor:"green"}]},options:{}})}async useMode(){const{width:t,height:s,ctx:a}=this;if(this.imgs.length<1){a.clearRect(0,0,t,s);return}const[i,...e]=this.imgs;let n=await i.getDataWithOptions();for(let r of e)n=await r.useMode(n);let d=new ImageData(n,t,s);a.putImageData(d,0,0)}}var k=(o,t)=>{const s=o.__vccOpts||o;for(const[a,i]of t)s[a]=i;return s};const R={data(){return{imgs:[],modes:["\u0441\u0443\u043C\u043C\u0430","\u0441\u0440\u0435\u0434\u043D\u0435\u0435","\u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435","\u043C\u0430\u043A\u0441\u0438\u043C\u0443\u043C","\u043C\u0438\u043D\u0438\u043C\u0443\u043C","\u043C\u0430\u0441\u043A\u0430","\u043D\u0430\u043B\u043E\u0436\u0435\u043D\u0438\u0435"],canals:["RGB","R","G","B","RG","RB","GB"],canal:"RGB"}},methods:{addFile(o){console.log(o);const t=o.target.files;for(let s of t){const a=URL.createObjectURL(s);console.log(a),this.imgs.push(new B(a))}this.useMode().then()},async useMode(){await engine.useMode()},imgHandler(){this.imgs},async deleteImg(o){this.imgs.splice(o,1),await this.useMode()},download(){engine.downImg()}},mounted(){engine=new D(document.getElementById("window"),this.imgs),this.engine=engine,vm=this},computed:{}},U={class:"between"},L={class:"left"},O=l("canvas",{id:"window"},null,-1),V=m(" \u043A\u0430\u043D\u0430\u043B "),W=["value"],E=l("canvas",{id:"hist"},null,-1),G={class:"right"},H=["src"],A=["onUpdate:modelValue"],F=["value"],N=m(" \u043F\u0440\u043E\u0437\u0440\u0430\u0447\u043D\u043E\u0441\u0442\u044C "),j=["onUpdate:modelValue"],P=l("br",null,null,-1),T=m(" \u0440\u0430\u0437\u043C\u0435\u0440"),S=["onUpdate:modelValue"],q=["onClick"];function K(o,t,s,a,i,e){return h(),c("div",U,[l("div",L,[O,l("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...n)=>e.download&&e.download(...n))}," \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443 "),V,g(l("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>i.canal=n),onChange:t[2]||(t[2]=n=>e.useMode())},[(h(!0),c(p,null,f(i.canals,n=>(h(),c("option",{value:n,key:n},w(n),9,W))),128))],544),[[v,i.canal]]),E]),l("div",G,[(h(!0),c(p,null,f(i.imgs,(n,d)=>(h(),c("div",{key:d},[l("img",{src:n.src},null,8,H),g(l("select",{"onUpdate:modelValue":r=>n.mode=r,onChange:t[3]||(t[3]=r=>e.useMode())},[(h(!0),c(p,null,f(i.modes,(r,y)=>(h(),c("option",{value:y,key:y},w(r),9,F))),128))],40,A),[[v,n.mode]]),N,g(l("input",{type:"range",max:"1",min:"0",step:"0.05","onUpdate:modelValue":r=>n.opacity=r,onChange:t[4]||(t[4]=r=>e.useMode())},null,40,j),[[I,n.opacity]]),m(w(n.opacity*100)+"%",1),P,T,g(l("input",{type:"range",min:"0",max:"1080",step:"5","onUpdate:modelValue":r=>n.width=r,onChange:t[5]||(t[5]=r=>e.useMode())},null,40,S),[[I,n.width]]),l("button",{class:"btn btn-danger",onClick:r=>e.deleteImg(d)},"x",8,q)]))),128)),l("input",{type:"file",onChange:t[6]||(t[6]=(...n)=>e.addFile&&e.addFile(...n)),multiple:"",accept:".png,.jpg,.jpeg",id:"drop"},null,32)])])}var z=k(R,[["render",K]]);C(z).mount("#app");
