var Ae=Object.defineProperty;var Te=(f,l,t)=>l in f?Ae(f,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):f[l]=t;var E=(f,l,t)=>(Te(f,typeof l!="symbol"?l+"":l,t),t);import{d as Xe,t as Q,r as q,u as d,o as b,c as N,a as o,V as ae,b as oe,w as r,e as C,f as O,g as M,h as $,i as I,C as Be,p as Re,j as Fe,k as Oe,L as pe,l as je,P as ge,m as Ke,B as qe,n as le,q as L,s as Ge,v as P,x as Z,y as Y,z as He,A as H,D as re,F as X,E as se,G as z,H as A,I as ve,J as K,K as $e,M as ue,N as de,O as ce,Q as ie,R as ne,S as We,T as Je,U as _e,W as xe,X as ye,Y as Ye,Z as J,_ as we,$ as be,a0 as Qe,a1 as Ze,a2 as et,a3 as tt,a4 as lt,a5 as nt}from"./vendor.c0f271ec.js";const at=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const e of a)if(e.type==="childList")for(const i of e.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(a){const e={};return a.integrity&&(e.integrity=a.integrity),a.referrerpolicy&&(e.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?e.credentials="include":a.crossorigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function s(a){if(a.ep)return;a.ep=!0;const e=t(a);fetch(a.href,e)}};at();class ll extends PIXI.Container{constructor(){super(...arguments);E(this,"Name","layer");E(this,"type","layer")}get r(){return(this.tint&16711680)/65536,(this.tint&16711680)/65536}set r(l){let t=l%256*65536+(65535&this.tint);this.tint=t}get g(){return(this.tint&65280)/256}set g(l){this.tint=l%256*256+(16711935&this.tint)}get b(){return this.tint&255}set b(l){this.tint=l%256+(16776960&this.tint)}}let G;class fe extends PIXI.Sprite{constructor(...l){super(...l);E(this,"Name","picture");E(this,"type","sprite");this.eventsBind()}eventsBind(){this.interactive=!0,this.buttonMode=!0;let l,t=0,s,a,e,i;const n=10;setTimeout(()=>{this.width>800&&(this.width=800),this.scale.y=this.scale.x},50),this.on("pointerdown",u=>{l=u.data.getLocalPosition(this),l.x*=this.scale.x,l.y*=this.scale.y,e=u.data.getLocalPosition(this.parent);const{width:c,height:g}=this;if(this.zIndexOld=this.zIndex,i=this,this.zIndex||(this.zIndex=0),this.zIndex=100,console.log(this.zIndex),s=c,a=g,l.x>c-n)return t=1;if(l.x<n)return t=2;if(l.y>g-n)return t=3;if(l.y<n)return t=4;t=0}),G.stage.on("pointerup",u=>{i&&(i.zIndex=i.zIndexOld),l=!1}),this.on("pointermove",u=>{const{ctrlKey:c}=u.data.originalEvent;if(l){const g=u.data.getLocalPosition(this.parent);t==0&&(this.x=g.x-l.x,this.y=g.y-l.y),t==1&&(this.width=s+g.x-e.x,c&&(this.scale.y=this.scale.x)),t==2&&(this.x=g.x-l.x,this.width=s-g.x+e.x),t==3&&(this.height=a+g.y-e.y,c&&(this.scale.x=this.scale.y)),t==4&&(this.y=g.y-l.y,this.height=a-g.y+e.y)}})}get r(){return(this.tint&16711680)/65536,(this.tint&16711680)/65536}set r(l){let t=l%256*65536+(65535&this.tint);this.tint=t}get g(){return(this.tint&65280)/256}set g(l){this.tint=l%256*256+(16711935&this.tint)}get b(){return this.tint&255}set b(l){this.tint=l%256+(16776960&this.tint)}pixels(){const l=this.texture.textureCacheIds[0],t=new fe;t.src=l,t.onload=function(){}}}class ot{constructor(l,t){E(this,"sprites",[]);E(this,"textures",[]);E(this,"width",1080);E(this,"height",768);E(this,"ctx");E(this,"view");E(this,"app");E(this,"room");E(this,"extract");E(this,"_sprites",0);this.sprites=t,G=new PIXI.Application({width:this.width,height:this.height,transparent:!0,resolution:window.devicePixelRatio||1}),this.extract=G.renderer.extract,this.app=G,this.view=G.view;const{stage:s}=G;s.interactive=!0,s.buttonMode=!0,this.stage=s;const a=s;a.sortableChildren=!0,a.Name="Main layer",a.id=0,this.room=a,t.push({Name:"Main layer",type:"layer",id:0}),this.ctx=this.view.getContext("webgl2"),l.appendChild(G.view)}async loadPixels(l){let{width:t,height:s}=l;const a=document.createElement("canvas");a.width=t,a.height=s;const e=a.getContext("2d");return e.drawImage(l,0,0,t,s),await e.getImageData(0,0,t,s).data}loadImg(l){return new Promise((t,s)=>{let a=new Image;a.src=l,a.onload=e=>{t(a)}})}pixels(){return this.extract.pixels(this.app.stage)}pixelsToHistogram(l){const t=_.map(_.range(256),e=>0);let s=[t.slice(),t.slice(),t.slice(),t.slice()],a;for(let e=0;e<l.length;e+=1)e%4!=3&&~~(e/4)*4+3!=0&&(a=l[e],s[e%4][a]+=1,s[3][a]+=1);return s}histogram(){const l=this.pixels();return this.pixelsToHistogram(l)}saveFile(l,t="outImg"){let s=document.createElement("a");s.setAttribute("href",l),s.setAttribute("download",t),s.click()}downImg(){const l=this.extract.image(this.app.stage);this.saveFile(l.src)}addSprite(l){const{textures:t,sprites:s,room:a}=this,e=PIXI.Texture.from(l);t.push(e),this._sprites+=1;const i=new fe(e);return i.id=this._sprites,s.push(i),a.addChild(i),i}}const F=Xe("game",{state:()=>({sprites:[],selectedSprite:void 0,drawer:!1,isEditor:!0,isList:!0})}),st={key:0},it=$(" width "),rt=$(" height "),ut=$(" red "),dt=$(" green "),ct=$(" blue "),ft=$(" alpha "),mt=$(" x "),ht=$(" y "),pt=$(" z "),gt={key:1},vt=I("h3",null,"\u0421\u043F\u0440\u0430\u0439\u0442 \u043D\u0435 \u0432\u044B\u0431\u0440\u0430\u043D \u0438\u043B\u0438 \u044F\u0432\u043B\u044F\u0435\u0442\u0441\u044F \u043D\u0435 \u0441\u043F\u0440\u0430\u0439\u0442\u043E\u043C",-1),_t=[vt],Pe={setup(f){const l=F(),t=Q(l,"selectedSprite"),s=q([{title:"normal",value:PIXI.BLEND_MODES.NORMAL},{title:"add",value:PIXI.BLEND_MODES.ADD},{title:"multiply",value:PIXI.BLEND_MODES.MULTIPLY},{title:"average",value:PIXI.BLEND_MODES.SCREEN}]);return(a,e)=>{var i;return((i=d(t))==null?void 0:i.type)=="sprite"?(b(),N("div",st,[o(ae,{label:"name",modelValue:d(t).Name,"onUpdate:modelValue":e[0]||(e[0]=n=>d(t).Name=n),"hide-details":""},null,8,["modelValue"]),o(oe,{label:"blend mode",items:d(s),modelValue:d(t).blendMode,"onUpdate:modelValue":e[1]||(e[1]=n=>d(t).blendMode=n),"hide-details":""},null,8,["items","modelValue"]),o(M,null,{default:r(()=>[o(C,{sm:"3"},{default:r(()=>[it]),_:1}),o(C,null,{default:r(()=>[o(O,{min:"0",max:"1080",step:"5","thumb-label":"","hide-details":"auto",color:"blue",modelValue:d(t).width,"onUpdate:modelValue":e[2]||(e[2]=n=>d(t).width=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(M,null,{default:r(()=>[o(C,{sm:"3"},{default:r(()=>[rt]),_:1}),o(C,null,{default:r(()=>[o(O,{min:"0",max:"1080",step:"5","thumb-label":"",color:"blue","hide-details":"auto",modelValue:d(t).height,"onUpdate:modelValue":e[3]||(e[3]=n=>d(t).height=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(M,null,{default:r(()=>[o(C,{sm:"3"},{default:r(()=>[ut]),_:1}),o(C,null,{default:r(()=>[o(O,{min:"0",max:"255",step:"5","thumb-label":"",color:"red","hide-details":"auto",modelValue:d(t).r,"onUpdate:modelValue":e[4]||(e[4]=n=>d(t).r=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(M,null,{default:r(()=>[o(C,{sm:"3"},{default:r(()=>[dt]),_:1}),o(C,null,{default:r(()=>[o(O,{min:"0",max:"255",step:"5","thumb-label":"",color:"green","hide-details":"auto",modelValue:d(t).g,"onUpdate:modelValue":e[5]||(e[5]=n=>d(t).g=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(M,null,{default:r(()=>[o(C,{sm:"3"},{default:r(()=>[ct]),_:1}),o(C,null,{default:r(()=>[o(O,{min:"0",max:"255",step:"5","thumb-label":"",color:"blue","hide-details":"auto",modelValue:d(t).b,"onUpdate:modelValue":e[6]||(e[6]=n=>d(t).b=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(M,null,{default:r(()=>[o(C,{xs:"1",sm:"3"},{default:r(()=>[ft]),_:1}),o(C,null,{default:r(()=>[o(O,{"hide-details":"auto",max:"1",min:"0",step:"0.05",color:"blue","thumb-label":"",modelValue:d(t).alpha,"onUpdate:modelValue":e[7]||(e[7]=n=>d(t).alpha=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(M,null,{default:r(()=>[o(C,{sm:"3"},{default:r(()=>[mt]),_:1}),o(C,null,{default:r(()=>[o(O,{min:"0",max:"1080",step:"5","thumb-label":"",color:"blue","hide-details":"auto",modelValue:d(t).x,"onUpdate:modelValue":e[8]||(e[8]=n=>d(t).x=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(M,null,{default:r(()=>[o(C,{sm:"3"},{default:r(()=>[ht]),_:1}),o(C,null,{default:r(()=>[o(O,{min:"0",max:"1080",step:"5","thumb-label":"",color:"blue","hide-details":"auto",modelValue:d(t).y,"onUpdate:modelValue":e[9]||(e[9]=n=>d(t).y=n)},null,8,["modelValue"])]),_:1})]),_:1}),o(M,null,{default:r(()=>[o(C,{sm:"3"},{default:r(()=>[pt]),_:1}),o(C,null,{default:r(()=>[o(O,{min:"-10",max:"10",step:"1","thumb-label":"",color:"blue","hide-details":"auto",modelValue:d(t).zIndex,"onUpdate:modelValue":e[10]||(e[10]=n=>d(t).zIndex=n)},null,8,["modelValue"])]),_:1})]),_:1})])):(b(),N("div",gt,_t))}}},De={props:{chartId:{type:String,default:"bar-chart"},datasetIdKey:{type:String,default:"label"},width:{type:Number,default:400},height:{type:Number,default:400},cssClasses:{default:"",type:String},styles:{type:Object,default:()=>{}},plugins:{type:Array,default:()=>[]},data:{type:Array,default:()=>[_.map(_.range(256),f=>0),_.map(_.range(256),f=>0),_.map(_.range(256),f=>0),_.map(_.range(256),f=>0)]}},setup(f){const l=f;Be.register(Re,Fe,Oe,pe,je,ge,Ke,qe,pe,ge);const t=le(a=>({labels:_.range(256),datasets:[{data:l.data[0],backgroundColor:"#F44336",label:"red"},{data:l.data[1],backgroundColor:"#4CAF50",label:"green"},{data:l.data[2],backgroundColor:"#2196F3",label:"blue"},{data:l.data[3].map(e=>~~(e/4)),backgroundColor:"	#C0C0C0",label:"multiply"}]})),s=q({responsive:!0});return(a,e)=>(b(),L(d(Ge),{"chart-options":d(s),"chart-data":d(t),"chart-id":f.chartId,"dataset-id-key":f.datasetIdKey,plugins:f.plugins,"css-classes":f.cssClasses,styles:f.styles,width:f.width,height:f.height},null,8,["chart-options","chart-data","chart-id","dataset-id-key","plugins","css-classes","styles","width","height"]))}},xt=$("mdi-content-save"),Me={setup(f){const{selectedSprite:l}=F();function t(h,...m){let v=new Date().getTime(),w=h(...m),V=new Date().getTime(),k=V-v,D=h.name;return{t1:v,t2:V,dt:k,res:w,name:D}}async function s(h){let{width:m,height:v}=h;const w=document.createElement("canvas");w.width=m,w.height=v;const V=w.getContext("2d");return V.drawImage(h,0,0,m,v),await V.getImageData(0,0,m,v).data}const a=_.map(_.range(256),h=>0),e=P([a,a,a,a]),i=P(!1),n=P(0);let u;const c=P(),g=P();Z(async h=>{const m=l.texture.baseTexture.cacheId,v=await engine.loadImg(m),w=await s(v),{width:V,height:k}=v;u=g.value,u.width=V,u.height=k,u.style.width="100%";const D=u.getContext("2d");let x=_.map(_.range(256),B=>0);const y=new GPU,{length:S}=w;let U=y.createKernel(function(B,W){const R=B[this.thread.x];return this.thread.x%4==3?R:W[R]},{output:[S],graphical:!1});function T(B,W){const R=new Float32Array(B.length);for(let j=0;j<B.length;j+=1){const he=B[j];j%4==3&&(R[j]=he),R[j]=W[he]}return R}function ee(){for(let R=0;R<256;R+=1){let j=me.get(R);x[R]=Math.floor(j)}let B;i.value?B=U(w,new Float32Array(x)):B=T(w,x);const W=new ImageData(new Uint8ClampedArray(B),V,k);D.putImageData(W,0,0),e.value=engine.pixelsToHistogram(B)}let te;const ze=c.value,me=new Newton([[0,0],[256,256]],ze);me.onUpdate=()=>{te=t(ee),n.value=te.dt},te=t(ee),n.value=te.dt});function p(){let h=u.toDataURL();const m=PIXI.Texture.from(h);l.texture=m}return(h,m)=>(b(),N(X,null,[o(M,{justify:"center"},{default:r(()=>[I("canvas",{ref_key:"splineRef",ref:c,width:"256",height:"256",style:{width:"100%"}},null,512),I("canvas",{ref_key:"cnvRef",ref:g},null,512)]),_:1}),o(De,{data:e.value},null,8,["data"]),$(" computed time "+Y(n.value)+" ",1),o(M,{justify:"space-around"},{default:r(()=>[o(He,{label:"GPU on",modelValue:i.value,"onUpdate:modelValue":m[0]||(m[0]=v=>i.value=v),color:"green","hide-details":""},null,8,["modelValue"]),o(H,{icon:"",color:"primary",onClick:m[1]||(m[1]=v=>p())},{default:r(()=>[o(re,null,{default:r(()=>[xt]),_:1})]),_:1})]),_:1})],64))}},yt=$("mdi-content-save"),Le={setup(f){const{selectedSprite:l}=F();let t;P([0,0,0,0]);let s,a,e;const i=P(),n=P();Z(async c=>{const g=l.texture.textureCacheIds[0];s=await engine.loadImg(g);const{width:p,height:h}=s;t=i.value,t.width=p,t.height=h,t.style.width="100%";const m=t.getContext("webgl2",{premultipliedAlpha:!1});a=new GPU({canvas:t,context:m}).createKernel(function(x,y){const S=x[this.thread.y][this.thread.x];this.color(y[Math.floor(S[0]*256)],y[Math.floor(S[1]*256)],y[Math.floor(S[2]*256)],S[3])},{output:[p,h],graphical:!0});let w=_.map(_.range(256),x=>0);function V(){new Date().getTime();for(let x=0;x<256;x+=1){let y=D.get(x);w[x]=y/256}new Date().getTime(),a(s,w),e=a.getPixels()}const k=n.value,D=new Newton([[0,0],[256,256],[128,100]],k);D.onUpdate=V,V()});function u(){const{width:c,height:g}=s,p=document.createElement("canvas");p.width=c,p.height=g;const h=p.getContext("2d"),m=new ImageData(new Uint8ClampedArray(e),c,g);h.putImageData(m,0,0);let v=p.toDataURL();l.texture.baseTexture=new PIXI.BaseTexture(v)}return(c,g)=>(b(),N(X,null,[o(M,{justify:"center"},{default:r(()=>[I("canvas",{ref_key:"splineRef",ref:n,width:"256",height:"256",style:{width:"100%"}},null,512),I("canvas",{ref_key:"cnvRef",ref:i,style:{width:"100%"}},null,512)]),_:1}),o(H,{icon:"",color:"primary",onClick:g[0]||(g[0]=p=>u())},{default:r(()=>[o(re,null,{default:r(()=>[yt]),_:1})]),_:1})],64))}};const wt=I("br",null,null,-1),bt=I("br",null,null,-1),Vt=I("br",null,null,-1),kt=I("br",null,null,-1),Ne={setup(f){const l=F(),t=Q(l,"selectedSprite"),s=`
      varying vec2 vTextureCoord;
      uniform sampler2D uSampler;
      uniform highp vec4 inputSize;
      uniform vec3 m1;
      uniform vec3 m2;
      uniform vec3 m3;
      uniform float size;
      mat3 mat = mat3(m1,m2,m3);
      void main(void)
      {
        vec2 cord = vTextureCoord;
        vec4 color;
        int i;
        int k;
        for(int i=0;i<3;i+=1){
          vec3 line = mat[i];
          for(int k=0;k<3;k+=1){
            vec2 ncord = vec2(cord.x+inputSize.z*float(i-1)*size,cord.y+inputSize.w*float(k-1)*size);
            color += texture2D(uSampler, ncord) *mat[i][k]  ;
          }
        }
        color.a =1.;
        gl_FragColor = color  ;
      }
      `;let a,e=P();function i(){a=new PIXI.Filter(null,s,{m1:[0,0,0],m2:[0,1,0],m3:[0,0,0],size:1,test:new Float32Array([1,2,3,4,5])}),t.value.filters=[a],e.value=a.uniforms}return i(),se(t,i),(n,u)=>(b(),N("div",null,[z(I("input",{type:"range",min:"0.5",max:"3",step:"0.1","onUpdate:modelValue":u[0]||(u[0]=c=>d(e).size=c)},null,512),[[A,d(e).size]]),wt,z(I("input",{type:"number","onUpdate:modelValue":u[1]||(u[1]=c=>d(e).m1[0]=c)},null,512),[[A,d(e).m1[0]]]),z(I("input",{type:"number","onUpdate:modelValue":u[2]||(u[2]=c=>d(e).m1[1]=c)},null,512),[[A,d(e).m1[1]]]),z(I("input",{type:"number","onUpdate:modelValue":u[3]||(u[3]=c=>d(e).m1[2]=c)},null,512),[[A,d(e).m1[2]]]),bt,z(I("input",{type:"number","onUpdate:modelValue":u[4]||(u[4]=c=>d(e).m2[0]=c)},null,512),[[A,d(e).m2[0]]]),z(I("input",{type:"number","onUpdate:modelValue":u[5]||(u[5]=c=>d(e).m2[1]=c)},null,512),[[A,d(e).m2[1]]]),z(I("input",{type:"number","onUpdate:modelValue":u[6]||(u[6]=c=>d(e).m2[2]=c)},null,512),[[A,d(e).m2[2]]]),Vt,z(I("input",{type:"number","onUpdate:modelValue":u[7]||(u[7]=c=>d(e).m3[0]=c)},null,512),[[A,d(e).m3[0]]]),z(I("input",{type:"number","onUpdate:modelValue":u[8]||(u[8]=c=>d(e).m3[1]=c)},null,512),[[A,d(e).m3[1]]]),z(I("input",{type:"number","onUpdate:modelValue":u[9]||(u[9]=c=>d(e).m3[2]=c)},null,512),[[A,d(e).m3[2]]]),kt]))}};function St(f,l){let t=0;for(let n=0;n<f.length;n+=1)t+=f[n];const s=Number(t)/f.length*3;let a=new Float32Array(f.length),e=0,i=0;for(let n=0;n<f.length;n+=1){const u=f[n];n%4==3&&(a[n]=u),n%4==0&&(e=f[n]+f[n+1]+f[n+2],e<=s?i=0:i=255,a[n]=i,a[n+1]=i,a[n+2]=i)}return a}function Ct(f,l){let{width:t,height:s}=l,a=new Array(256).fill(0);for(let p=0;p<f.length;p+=1)p%4<3&&(a[f[p]]+=1);a=a.map(p=>p/(3*t*s));const e=a.reduce((p,h,m)=>p+h*m,0);let i=0,n=0;for(let p=0;p<a.length;p++){const h=a.slice(0,p),m=h.reduce((D,x)=>D+x,0),v=1-m,w=h.reduce((D,x,y)=>D+x*y,0)/m,V=(e-w*m)/v,k=m*v*(w-V)**2;k>i&&(i=k,n=p)}let u=new Float32Array(f.length),c=0,g=0;for(let p=0;p<f.length;p+=1){const h=f[p];p%4==3&&(u[p]=h),p%4==0&&(c=(f[p]+f[p+1]+f[p+2])/3,c<=n?g=0:g=255,u[p]=g,u[p+1]=g,u[p+2]=g)}return u}let Ve=0;function It(f,l,t,s){const{width:a,height:e}=l;Ve=f.createKernel(function(i,n,u){const{x:c,y:g}=this.thread,p=Math.floor(n/2);let h=0,m=0;for(let x=0;x<n;x+=1)for(let y=0;y<n;y+=1){const S=i[g+x-p][c+y-p],U=S[0]+S[1]+S[2];h+=U,m+=U*U}h/=n*n,m/=n*n;const v=m-h*h,w=Math.sqrt(v),V=h+w*u,k=i[g][c];k[0]+k[1]+k[2]<=V?this.color(0,0,0,k[3]):this.color(1,1,1,k[3])},{output:[a,e],graphical:!0}),Ve(l,t,s)}let ke=0;function Ut(f,l,t,s){const{width:a,height:e}=l;ke=f.createKernel(function(i,n,u){const{x:c,y:g}=this.thread,p=Math.floor(n/2);let h=0,m=0;for(let x=0;x<n;x+=1)for(let y=0;y<n;y+=1){const S=i[g+x-p][c+y-p],U=S[0]+S[1]+S[2];h+=U,m+=U*U}h/=n*n,m/=n*n;const v=m-h*h,w=Math.sqrt(v),V=h*(1+u*(w/1.5-1)),k=i[g][c];k[0]+k[1]+k[2]<=V?this.color(0,0,0,k[3]):this.color(1,1,1,k[3])},{output:[a,e],graphical:!0}),ke(l,t,s)}let Se=0;function $t(f,l,t,s){const{width:a,height:e}=l;Se=f.createKernel(function(i,n,u){const{x:c,y:g}=this.thread,p=Math.floor(n/2);let h=0,m=0,v=3;for(let y=0;y<n;y+=1)for(let S=0;S<n;S+=1){const U=i[g+y-p][c+S-p],T=U[0]+U[1]+U[2];T<3&&(v=T),h+=T,m+=T*T}h/=n*n,m/=n*n;const w=m-h*h,V=Math.sqrt(w),k=(1-u)*h+u*v+u*V*(h-v),D=i[g][c];D[0]+D[1]+D[2]<=k?this.color(0,0,0,D[3]):this.color(1,1,1,D[3])},{output:[a,e],graphical:!0}),Se(l,t,s)}let Ce=0;function Pt(f,l,t,s){const{width:a,height:e}=l;Ce=f.createKernel(function(i,n,u){const{x:c,y:g}=this.thread,p=Math.floor(n/2);let h=0;for(let w=0;w<n;w+=1)for(let V=0;V<n;V+=1){const k=i[g+w-p][c+V-p];h+=k[0]+k[1]+k[2]}const m=i[g][c],v=m[0]+m[1]+m[2];h*(1-u)<=v*n*n?this.color(1,1,1,m[3]):this.color(0,0,0,m[3])},{output:[a,e],graphical:!0}),Ce(l,t,s)}const Ee={setup(f){const l=F(),t=Q(l,"selectedSprite");let s,a,e,i;const n=P();async function u(x){s=t.value.texture.textureCacheIds[0],a=await engine.loadImg(s),e=await engine.loadPixels(a);const{width:y,height:S}=a,U=n.value;U.width=y,U.height=S,U.style.width="100%",V(0)}se(t,u),Z(u);function c(x){if(x==0)return St(e);if(x==1)return Ct(e,a)}const g=P(!1);function p(x){g.value=!1;const{width:y,height:S}=a,U=n.value.getContext("2d");let T;T=c(x);const ee=new ImageData(new Uint8ClampedArray(T),y,S);U.putImageData(ee,0,0)}const h=P(void 0),m=P(15),v=P(-.2);function w(x){const{width:y,height:S}=a;if(!i){const U=h.value;U.width=y,U.height=S,U.style.width="100%";const T=U.getContext("webgl2",{premultipliedAlpha:!1});i=new GPU({canvas:U,context:T}),g.value=!0}x==2&&It(i,a,m.value,v.value),x==3&&Ut(i,a,m.value,v.value),x==4&&$t(i,a,m.value,v.value),x==5&&Pt(i,a,m.value,v.value)}function V(x){if(x<2)return p(x);w(x)}const k=P(0),D=q([{title:"Gavrilov",value:0},{title:"Otsu",value:1},{title:"Niblack",value:2},{title:"Sauvola",value:3},{title:"Wolf",value:4},{title:"Bradley",value:5}]);return(x,y)=>(b(),N(X,null,[o(oe,{"onUpdate:modelValue":[V,y[0]||(y[0]=S=>k.value=S)],label:"methods",items:d(D),modelValue:k.value},null,8,["items","modelValue"]),z(o(M,{justify:"center"},{default:r(()=>[I("canvas",{ref_key:"cnv",ref:n},null,512)]),_:1},512),[[ve,!g.value]]),z(o(M,{justify:"center"},{default:r(()=>[I("canvas",{ref_key:"cnv1",ref:h},null,512),o(ae,{modelValue:m.value,"onUpdate:modelValue":[y[1]||(y[1]=S=>m.value=S),y[2]||(y[2]=S=>V(k.value))],step:"1",label:"\u0440\u0430\u0437\u043C\u0435\u0440",type:"number","hide-details":"auto"},null,8,["modelValue"]),o(ae,{modelValue:v.value,"onUpdate:modelValue":[y[3]||(y[3]=S=>v.value=S),y[4]||(y[4]=S=>V(k.value))],step:"0.1",label:"\u043A\u043E\u044D\u0444\u0444\u0438\u0446\u0438\u0435\u043D\u0442",type:"number","hide-details":"auto"},null,8,["modelValue"])]),_:1},512),[[ve,g.value]])],64))}},Dt=["src"],Mt={setup(f){const l=F(),t=Q(l,"selectedSprite"),s=P(0);se(t,()=>{const e=s.value;s.value=0,s.value=e});const a=q([{title:"Params",value:0},{title:"Curves",value:1},{title:"Curves faster",value:2},{title:"Mask filtration",value:3},{title:"Binarization",value:4}]);return(e,i)=>d(t)?(b(),L(de,{key:0},{default:r(()=>[o(ue,null,{default:r(()=>[o(M,{justify:"center"},{default:r(()=>[o(C,{sm:"8"},{default:r(()=>[d(t).texture?(b(),N("img",{key:0,style:{width:"100%"},src:d(t).texture.textureCacheIds[0]},null,8,Dt)):K("",!0)]),_:1})]),_:1}),o(oe,{label:"window",items:d(a),modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=n=>s.value=n),"hide-details":""},null,8,["items","modelValue"]),o($e,{style:{margin:"10px 0px"}}),s.value==0?(b(),L(Pe,{key:0})):s.value==1?(b(),L(Me,{key:1})):s.value==2?(b(),L(Le,{key:2})):s.value==3?(b(),L(Ne,{key:3})):s.value==4?(b(),L(Ee,{key:4})):K("",!0)]),_:1})]),_:1})):K("",!0)}},Lt=I("h2",null,"List of layers",-1),Nt=["src"],Et=$(" mdi-delete "),zt=$(" add picture "),Ie={setup(f){const l=F(),{sprites:t}=l,{drawer:s}=ce(l);function a(n){l.selectedSprite=n,s.value=!1}function e(n){const[u]=t.splice(n,1),{room:c}=engine;c.children=c.children.filter(g=>g.id!=u.id)}function i(n){const u=document.createElement("input");u.type="file",u.multiple=!0,u.accept=".png,.jpg,.jpeg",u.onchange=function(c){console.log(c);const g=c.target.files;for(let p of g){const h=URL.createObjectURL(p),m=engine.addSprite(h);m.on("pointerdown",v=>{a(m)})}},u.click()}return(n,u)=>(b(),N(X,null,[Lt,(b(!0),N(X,null,ie(d(t),(c,g)=>(b(),L(de,{key:g,onClick:p=>a(c)},{default:r(()=>[o(ue,null,{default:r(()=>[o(M,{align:"center"},{default:r(()=>[c.texture?(b(),N(X,{key:0},[o(C,{cols:"2",sm:"3"},{default:r(()=>[I("img",{src:c.texture.textureCacheIds[0],style:{width:"100%"}},null,8,Nt)]),_:2},1024),o(C,{cols:"8",sm:"6"},{default:r(()=>[$(Y(c.Name),1)]),_:2},1024),o(C,{cols:"2",sm:"3"},{default:r(()=>[I("div",null,[o(H,{icon:"",onClick:p=>e(g),color:"red"},{default:r(()=>[o(re,null,{default:r(()=>[Et]),_:1})]),_:2},1032,["onClick"])])]),_:2},1024)],64)):(b(),L(C,{key:1},{default:r(()=>[$(Y(c.Name),1)]),_:2},1024))]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),o(H,{color:"green",onClick:i},{default:r(()=>[zt]),_:1})],64))}},At=$(" alpha "),Tt=$(" width "),Xt=$(" height "),Bt={props:["selectedSprite"],setup(f){const{room:l}=engine,t=le({get:()=>l.alpha,set:e=>l.alpha=e}),s=le({get:()=>l.width,set:e=>l.width=e}),a=le({get:()=>l.height,set:e=>l.height=e});return(e,i)=>(b(),N(X,null,[o(ae,{label:"name",modelValue:f.selectedSprite.Name,"onUpdate:modelValue":i[0]||(i[0]=n=>f.selectedSprite.Name=n),"hide-details":""},null,8,["modelValue"]),o(M,null,{default:r(()=>[o(C,{xs:"1",sm:"3"},{default:r(()=>[At]),_:1}),o(C,null,{default:r(()=>[z(I("input",{type:"range",max:"1",min:"0",step:"0.05",color:"blue","onUpdate:modelValue":i[1]||(i[1]=n=>ne(t)?t.value=n:null)},null,512),[[A,d(t)]])]),_:1})]),_:1}),o(M,null,{default:r(()=>[o(C,{sm:"3"},{default:r(()=>[Tt]),_:1}),o(C,null,{default:r(()=>[z(I("input",{type:"range",min:"0",max:"1080",step:"5",color:"blue","onUpdate:modelValue":i[2]||(i[2]=n=>ne(s)?s.value=n:null)},null,512),[[A,d(s)]])]),_:1})]),_:1}),o(M,null,{default:r(()=>[o(C,{sm:"3"},{default:r(()=>[Xt]),_:1}),o(C,null,{default:r(()=>[z(I("input",{type:"range",min:"0",max:"1080",step:"5",color:"blue","thumb-label":"","onUpdate:modelValue":i[3]||(i[3]=n=>ne(a)?a.value=n:null)},null,512),[[A,d(a)]])]),_:1})]),_:1})],64))}},Rt=$("update histogram"),Ft={props:["selectedSprite"],setup(f){const l=_.map(_.range(256),a=>0),t=P([l,l,l,l]);function s(){t.value=q(engine.histogram())}return(a,e)=>(b(),N(X,null,[o(De,{data:t.value},null,8,["data"]),o(H,{color:"green",onClick:s},{default:r(()=>[Rt]),_:1})],64))}},Ot={setup(f){const l=F(),t=Q(l,"selectedSprite"),s=P(0),a=q([{title:"params",value:0},{title:"gradient transformations",value:1}]);return(e,i)=>d(t)?(b(),L(de,{key:0},{default:r(()=>[o(ue,null,{default:r(()=>[o(oe,{label:"window",items:d(a),modelValue:s.value,"onUpdate:modelValue":i[0]||(i[0]=n=>s.value=n),"hide-details":""},null,8,["items","modelValue"]),o($e,{style:{margin:"10px 0px"}}),s.value==0?(b(),L(Bt,{key:0,selectedSprite:d(t)},null,8,["selectedSprite"])):s.value==1?(b(),L(Ft,{key:1,selectedSprite:d(t)},null,8,["selectedSprite"])):K("",!0)]),_:1})]),_:1})):K("",!0)}};const jt=$(" options "),Kt=$(" windows "),qt={setup(f){const l=F(),{selectedSprite:t,drawer:s,isEditor:a,isList:e}=ce(l),i=[P(),P(),P(),P(),P()];Z(()=>{i.map(h=>{var m,v;return(v=(m=h.value)==null?void 0:m.winbox)==null?void 0:v.close()})});const n=()=>s.value=!!(1-s.value),u=h=>{var v,w,V;const m=(v=i[h])==null?void 0:v.value;if(!!m){if(h==0){m.initialized||m.initialize();return}if(((w=t.value)==null?void 0:w.type)=="sprite")return m.initialized&&((V=m.winbox)==null||V.close()),m.initialize()}},c=q([{title:"download",func:()=>engine.downImg()},{title:"editor toggle",func:()=>a.value=!a.value},{title:"sprite list toggle",func:()=>e.value=!e.value}]),g=h=>h.func&&h.func(),p=q(["params","curves","curves fast","mask filtration","binarization"]);return(h,m)=>(b(),N(X,null,[o(Ye,{"extension-height":"40"},{prepend:r(()=>[o(We,{onClick:n})]),append:r(()=>[]),default:r(()=>[o(Je,null,{default:r(()=>[o(_e,null,{activator:r(({props:v})=>[o(H,xe({color:"primary"},v),{default:r(()=>[jt]),_:2},1040)]),default:r(()=>[o(ye,null,{default:r(()=>[(b(!0),N(X,null,ie(d(c),(v,w)=>(b(),L(be,{key:w,value:v,onClick:V=>g(v)},{default:r(()=>[o(we,null,{default:r(()=>[$(Y(v.title),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:1})]),_:1}),o(_e,null,{activator:r(({props:v})=>[o(H,xe({color:"primary"},v),{default:r(()=>[Kt]),_:2},1040)]),default:r(()=>[o(ye,null,{default:r(()=>[(b(!0),N(X,null,ie(d(p),(v,w)=>(b(),L(be,{key:w,value:v,onClick:V=>u(w)},{default:r(()=>[o(we,null,{default:r(()=>[$(Y(v),1)]),_:2},1024)]),_:2},1032,["value","onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}),o(d(J),{options:{title:"params",class:"modern",height:"500px",width:"300px"},ref:i[0]},{default:r(()=>[o(Pe)]),_:1},512),o(d(J),{options:{title:"curves",class:"modern",height:"600px",width:"300px"},ref:i[1]},{default:r(()=>[o(Me)]),_:1},512),o(d(J),{options:{title:"curves fast",class:"modern",height:"600px",width:"300px"},ref:i[2]},{default:r(()=>[o(Le)]),_:1},512),o(d(J),{options:{title:"masks filtration",class:"modern",height:"300px",width:"300px"},ref:i[3]},{default:r(()=>[o(Ne)]),_:1},512),o(d(J),{options:{title:"binarization",class:"modern",height:"500px",width:"300px"},ref:i[4]},{default:r(()=>[o(Ee)]),_:1},512)],64))}};const Gt=I("div",{id:"window"},null,-1),Ht={setup(f){const l=F(),{sprites:t}=l,{selectedSprite:s,drawer:a,isEditor:e,isList:i}=ce(l);return se(l,()=>{const{isEditor:n,isList:u}=l,c={isEditor:n,isList:u};localStorage.appCash=JSON.stringify(c)}),Z(()=>{if(localStorage.appCash){const n=JSON.parse(localStorage.appCash);for(let u in n)l[u]=n[u]}engine=new ot(document.getElementById("window"),t),vm=this}),(n,u)=>(b(),L(Qe,null,{default:r(()=>[o(qt),o(Ze,{modelValue:d(a),"onUpdate:modelValue":u[0]||(u[0]=c=>ne(a)?a.value=c:null),absolute:"",bottom:"",temporary:""},{default:r(()=>[o(Ie)]),_:1},8,["modelValue"]),o(et,null,{default:r(()=>[o(M,null,{default:r(()=>[o(C,{sm:d(e)||d(i)?8:12,cols:"12"},{default:r(()=>[Gt]),_:1},8,["sm"]),d(e)||d(i)?(b(),L(C,{key:0,sm:"4",style:{height:"96vh","overflow-y":"auto"}},{default:r(()=>{var c;return[d(e)?(b(),N(X,{key:0},[((c=d(s))==null?void 0:c.type)=="layer"?(b(),L(Ot,{key:0})):(b(),L(Mt,{key:1}))],64)):K("",!0),d(i)?(b(),L(Ie,{key:1})):K("",!0)]}),_:1})):K("",!0)]),_:1})]),_:1})]),_:1}))}};var Wt=tt();const Jt="modulepreload",Ue={},Yt="./",Qt=function(l,t){return!t||t.length===0?l():Promise.all(t.map(s=>{if(s=`${Yt}${s}`,s in Ue)return;Ue[s]=!0;const a=s.endsWith(".css"),e=a?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${s}"]${e}`))return;const i=document.createElement("link");if(i.rel=a?"stylesheet":Jt,a||(i.as="script",i.crossOrigin=""),i.href=s,document.head.appendChild(i),a)return new Promise((n,u)=>{i.addEventListener("load",n),i.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${s}`)))})})).then(()=>l())};async function Zt(){(await Qt(()=>import("./webfontloader.cd097671.js").then(function(l){return l.w}),[])).load({google:{families:["Roboto:100,300,400,500,700,900&display=swap"]}})}Zt();lt(Ht).use(Wt,{},!1,"bootstrap3").use(nt()).mount("#app");
