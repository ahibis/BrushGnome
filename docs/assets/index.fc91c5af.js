var x=Object.defineProperty;var b=(o,t,s)=>t in o?x(o,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[t]=s;var u=(o,t,s)=>(b(o,typeof t!="symbol"?t+"":t,s),s);import{o as d,c,a as l,w as g,v as y,F as m,r as p,b as I,t as f,d as v,e as C}from"./vendor.d242409d.js";const M=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))a(e);new MutationObserver(e=>{for(const i of e)if(i.type==="childList")for(const n of i.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function s(e){const i={};return e.integrity&&(i.integrity=e.integrity),e.referrerpolicy&&(i.referrerPolicy=e.referrerpolicy),e.crossorigin==="use-credentials"?i.credentials="include":e.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function a(e){if(e.ep)return;e.ep=!0;const i=s(e);fetch(e.href,i)}};M();class B{loadImg(t){if(t==this._src&&this._img)return this._img;let s=this;return new Promise((a,e)=>{let i=new Image;i.src=t,s._src=t,this._img=i,i.onload=n=>{a(i)}})}constructor(t="",s=0,a=0,e=0){this.x=s,this.y=a,this.src=t,this.mode=0,this.type="Image",this.name="test",this.width=e,this.imgWidth=100,this.imgHeight=100,this.opacity=1,this.height=100,this._img=null,this._src=null,this.pixels=null,this.lastWidth=null}async getHeight(){let t=await this.loadImg(this.src);return this.imgWidth=t.width,this.imgHeight=t.height,this.width==0&&(this.width=this.imgWidth),this.width>engine.width&&(this.width=engine.width),this.height=this.width*t.height/t.width,this.height}async draw(t){this._img=await this.loadImg(this.src);let s=this._img;await this.getHeight(),t.drawImage(this._img,this.x,this.y,this.width,this.width*s.height/s.width)}async getData(){const t=document.createElement("canvas"),{width:s,height:a}=engine;t.width=s,t.height=a;const e=t.getContext("2d");await this.draw(e);let i=await e.getImageData(0,0,s,a).data;return this.pixels=i,i}async getDataWithOptions(){let t;return this.pixels&&this.lastWidth!=this.width?t=this.pixels:t=await this.getData(),this.lastWidth=this.width,(this.opacity<.95||vm.canal!="RGB")&&(t=t.map((s,a)=>{let e=a%4;return e==0&&!/R/.test(vm.canal)||e==1&&!/G/.test(vm.canal)||e==2&&!/B/.test(vm.canal)?0:this.opacity<.95?~~(s*this.opacity):s})),t}async useMode(t){const{mode:s}=this;let a=await this.getDataWithOptions();return s==0?t.map((e,i)=>{let n=e+a[i];return n>255&&(n=255),n}):s==1?t.map((e,i)=>~~((e+a[i])/2)):s==2?t.map((e,i)=>~~(e*a[i]/256)):s==3?t.map((e,i)=>max(e,a[i])):s==4?t.map((e,i)=>min(e,a[i])):s==5?t.map((e,i)=>i%4!=3?e:a[i]):s==6?t.map((e,i)=>a[i]):t}}class D{constructor(t,s){u(this,"imgs",[]);u(this,"el");u(this,"width",1080);u(this,"height",768);u(this,"ctx");[this.el,this.imgs]=[t,s],this.ctx=t.getContext("2d"),t.width=this.width,t.height=this.height}canvasToImg(t){let s=t.toDataURL(),a=new Image;return a.src=s,a}saveImage(t){let s=document.createElement("a");s.setAttribute("href",t.src),s.setAttribute("download","outImg"),s.click()}downImg(){this.saveImage(this.canvasToImg(this.el))}async drawHist(){const t=document.getElementById("hist").getContext("2d"),{ctx:s,width:a,height:e}=this;let i=await s.getImageData(0,0,a,e).data,n=[..._.range(0,256)],h=n.map(r=>0);for(let r in i)r%4!=3&&(h[i[r]]+=1);h[0]=0,new Chart(t,{type:"bar",data:{labels:n,datasets:[{label:"Histogram",data:h,backgroundColor:"green"}]},options:{}})}async useMode(){const{width:t,height:s,ctx:a}=this;if(this.imgs.length<1){a.clearRect(0,0,t,s);return}const[e,...i]=this.imgs;let n=await e.getDataWithOptions();for(let r of i)n=await r.useMode(n);let h=new ImageData(n,t,s);a.putImageData(h,0,0)}}var k=(o,t)=>{const s=o.__vccOpts||o;for(const[a,e]of t)s[a]=e;return s};const R={data(){return{imgs:[],modes:["\u0441\u0443\u043C\u043C\u0430","\u0441\u0440\u0435\u0434\u043D\u0435\u0435","\u043F\u0440\u043E\u0438\u0437\u0432\u0435\u0434\u0435\u043D\u0438\u0435","\u043C\u0430\u043A\u0441\u0438\u043C\u0443\u043C","\u043C\u0438\u043D\u0438\u043C\u0443\u043C","\u043C\u0430\u0441\u043A\u0430","\u043D\u0430\u043B\u043E\u0436\u0435\u043D\u0438\u0435"],canals:["RGB","R","G","B","RG","RB","GB"],canal:"RGB"}},methods:{addFile(o){console.log(o);const t=o.target.files;for(let s of t){const a=URL.createObjectURL(s);console.log(a),this.imgs.push(new B(a))}this.useMode().then()},async useMode(){await engine.useMode()},imgHandler(){this.imgs},async deleteImg(o){this.imgs.splice(o,1),await this.useMode()},download(){engine.downImg()}},mounted(){engine=new D(document.getElementById("window"),this.imgs),this.engine=engine,vm=this},computed:{}},U={class:"between"},L={class:"left"},O=l("canvas",{id:"window"},null,-1),V=I(" \u043A\u0430\u043D\u0430\u043B "),W=["value"],E=l("canvas",{id:"hist"},null,-1),G={class:"right"},H=["src"],A=["onUpdate:modelValue"],F=["value"],N=["onUpdate:modelValue"],j=["onUpdate:modelValue"],P=["onClick"];function T(o,t,s,a,e,i){return d(),c("div",U,[l("div",L,[O,l("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...n)=>i.download&&i.download(...n))}," \u0441\u043E\u0445\u0440\u0430\u043D\u0438\u0442\u044C \u043A\u0430\u0440\u0442\u0438\u043D\u043A\u0443 "),V,g(l("select",{"onUpdate:modelValue":t[1]||(t[1]=n=>e.canal=n),onChange:t[2]||(t[2]=n=>i.useMode())},[(d(!0),c(m,null,p(e.canals,n=>(d(),c("option",{value:n,key:n},f(n),9,W))),128))],544),[[y,e.canal]]),E]),l("div",G,[(d(!0),c(m,null,p(e.imgs,(n,h)=>(d(),c("div",{key:h},[l("img",{src:n.src},null,8,H),g(l("select",{"onUpdate:modelValue":r=>n.mode=r,onChange:t[3]||(t[3]=r=>i.useMode())},[(d(!0),c(m,null,p(e.modes,(r,w)=>(d(),c("option",{value:w,key:w},f(r),9,F))),128))],40,A),[[y,n.mode]]),g(l("input",{type:"range",max:"1",min:"0",step:"0.05","onUpdate:modelValue":r=>n.opacity=r,onChange:t[4]||(t[4]=r=>i.useMode())},null,40,N),[[v,n.opacity]]),I(f(n.opacity*100)+"% \u0440\u0430\u0437\u043C\u0435\u0440",1),g(l("input",{type:"range",min:"0",max:"1080",step:"5","onUpdate:modelValue":r=>n.width=r,onChange:t[5]||(t[5]=r=>i.useMode())},null,40,j),[[v,n.width]]),l("button",{class:"btn btn-danger",onClick:r=>i.deleteImg(h)},"x",8,P)]))),128)),l("input",{type:"file",onChange:t[6]||(t[6]=(...n)=>i.addFile&&i.addFile(...n)),multiple:"",accept:".png,.jpg,.jpeg",id:"drop"},null,32)])])}var S=k(R,[["render",T]]);C(S).mount("#app");
